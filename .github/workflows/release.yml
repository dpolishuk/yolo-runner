name: release

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - os: darwin
            arch: amd64
            artifact: yolo-runner_darwin_amd64.tar.gz
          - os: darwin
            arch: arm64
            artifact: yolo-runner_darwin_arm64.tar.gz
          - os: linux
            arch: amd64
            artifact: yolo-runner_linux_amd64.tar.gz
          - os: linux
            arch: arm64
            artifact: yolo-runner_linux_arm64.tar.gz
          - os: windows
            arch: amd64
            artifact: yolo-runner_windows_amd64.zip
    steps:
      - name: Package artifact
        run: |
          mkdir -p dist
          echo "artifact placeholder" > "dist/${{ matrix.artifact }}"
      - name: Generate checksum artifact
        run: |
          sha256sum "dist/${{ matrix.artifact }}" > dist/checksums.txt
      - name: Publish release artifacts
        run: |
          echo "uploading ${{ matrix.artifact }} and checksums.txt"
