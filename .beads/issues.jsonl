{"id":"yolo-1dk","title":"Task 1: Build capability probe and lifecycle strategy abstraction for beads backends","design":"## Goal\nDeliver production-safe capability detection and lifecycle strategy abstraction for dual `bd`/`br` support while keeping existing yolo-agent loop behavior unchanged.\n\n## Effort Estimate\n- 6-8 hours (single implementation subtask; no further breakdown required).\n\n## Implementation Checklist\n1. Baseline code study (read before changes)\n- `internal/beads/beads.go` (current command contract and error paths)\n- `internal/beads/task_manager.go` (status/data lifecycle integration)\n- `cmd/yolo-agent/tracker_profile.go` (tracker wiring + validation paths)\n\n2. TDD first: add failing tests that catch real regressions\n- [ ] `internal/beads/capabilities_test.go`: detects backend profile for `bd`, `br`, and unsupported binary.\n- [ ] `internal/beads/capabilities_test.go`: verifies sync mode classification (active vs flush_only vs noop) based on probed capabilities.\n- [ ] `internal/beads/strategy_test.go`: verifies lifecycle routing calls expected command set for each profile.\n- [ ] `internal/beads/strategy_test.go`: verifies probe failure surfaces actionable error (no silent fallback).\n\n3. Minimal production changes to satisfy tests\n- [ ] Add `TrackerCapabilities` model and `ProbeTrackerCapabilities(...)` with explicit error taxonomy.\n- [ ] Add unified lifecycle strategy interface (`SelectReady`, `Claim`, `SetStatus`, `SetData`, `Close`, `FinalizeSync`).\n- [ ] Implement baseline `bd` strategy preserving current behavior.\n- [ ] Implement initial `br` strategy with supported command subset and explicit finalize behavior.\n- [ ] Wire strategy selection from capability probe in beads integration entry point(s).\n\n4. Verification\n- [ ] Run targeted tests for new probe/strategy modules.\n- [ ] Run existing beads tests to confirm no regressions.\n\n## Success Criteria (MEASURABLE)\n- [ ] `go test ./internal/beads -run TestProbeTrackerCapabilities -count=1` passes with explicit `bd`, `br`, and unsupported coverage.\n- [ ] `go test ./internal/beads -run TestLifecycleStrategyRouting -count=1` passes and verifies command routing differs correctly by capability profile.\n- [ ] Existing beads suite remains green: `go test ./internal/beads -count=1`.\n- [ ] Probe/strategy failures return actionable error text naming failing capability and remediation hint (asserted by tests).\n\n## Key Considerations (SRE)\n- **Version drift:** Upstream `bd` sync semantics can change; capability probe must drive behavior, not version-agnostic assumptions.\n- **Safe failure mode:** If probe is inconclusive, fail closed with actionable diagnostics; do not perform status transitions under unknown semantics.\n- **Command contract parity:** Preserve existing `bd` behavior as compatibility baseline to avoid regressions in current workflows.\n- **Edge cases to test:** missing binary, malformed version output, unsupported flags, empty JSON response, and command timeout/exit non-zero paths.\n\n## Anti-Patterns (FORBIDDEN)\n- ❌ No hardcoded `bd sync` behavior across all environments (reason: semantics vary by tool/version).\n- ❌ No silent fallback from unknown backend profile to `bd` defaults (reason: can corrupt task state).\n- ❌ No tests that only assert function existence or non-nil values (reason: tautological tests miss real bugs).\n- ❌ No TODO/unimplemented stubs in production strategy routing paths (reason: runtime gaps in lifecycle operations).","status":"closed","priority":1,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-23T04:58:24.57980365-05:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-23T05:05:50.867258125-05:00","closed_at":"2026-02-23T05:05:50.867258125-05:00","close_reason":"Closed","dependencies":[{"issue_id":"yolo-1dk","depends_on_id":"yolo-xu8","type":"parent-child","created_at":"2026-02-23T04:58:29.760143573-05:00","created_by":"Dmitry Polishuk"}]}
{"id":"yolo-5fs","title":"Task 3: Add yolo-agent beads E2E path and finalize epic verification readiness","design":"## Goal\nDeliver explicit yolo-agent beads E2E coverage and probe-failure assertions so epic acceptance for beads E2E support is met.\n\n## Effort Estimate\n- 4-8 hours.\n\n## Implementation Checklist\n1. Add beads E2E lane in `cmd/yolo-agent/e2e_test.go`\n- [ ] Add at least one test that runs through yolo-agent components using a beads profile/task manager path.\n- [ ] Assert key lifecycle outputs (task started/completed/closed signals) to ensure path is behaviorally meaningful.\n\n2. Add failure-path coverage for beads capability probe in yolo-agent path\n- [ ] Add test(s) in `cmd/yolo-agent/tracker_profile_test.go` and/or `cmd/yolo-agent/e2e_test.go` asserting actionable error text when beads probe fails.\n- [ ] Ensure no silent fallback behavior is observed.\n\n3. Verification and regression checks\n- [ ] Run focused E2E tests covering beads lane.\n- [ ] Run tracker profile selection and docs contract tests to avoid regressions.\n\n## Success Criteria (MEASURABLE)\n- [ ] `go test ./cmd/yolo-agent -run \"TestE2E_.*Beads|Test.*Beads.*\" -count=1` passes with at least one beads E2E path.\n- [ ] `go test ./cmd/yolo-agent -run \"TestBuildTaskManagerForTrackerSupportsBeads|TestBuildTaskManagerForTrackerWrapsBeadsProbeErrors\" -count=1` passes.\n- [ ] `go test ./cmd/yolo-agent -run \"TestDetectTrackerType|TestResolveTrackerProfile\" -count=1` passes.\n- [ ] `go test ./internal/docs -count=1` remains green.\n\n## Key Considerations (SRE)\n- **Edge case:** beads backend unavailable in environment should yield deterministic actionable error text.\n- **Edge case:** E2E test must validate behavior (events/status transitions), not just constructor success.\n- **Safety:** preserve existing non-beads E2E lanes and avoid broad refactors.\n\n## Anti-Patterns (FORBIDDEN)\n- ❌ No fake E2E tests that only assert non-nil manager instances.\n- ❌ No swallowing probe failures to allow execution to continue.\n- ❌ No changing epic requirements to avoid missing E2E coverage.\n- ❌ No unrelated tracker architecture changes in this task.","status":"open","priority":1,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-23T05:12:33.920929186-05:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-23T05:12:59.655004276-05:00","dependencies":[{"issue_id":"yolo-5fs","depends_on_id":"yolo-xu8","type":"parent-child","created_at":"2026-02-23T05:12:39.11181216-05:00","created_by":"Dmitry Polishuk"},{"issue_id":"yolo-5fs","depends_on_id":"yolo-5su","type":"blocks","created_at":"2026-02-23T05:12:44.292050622-05:00","created_by":"Dmitry Polishuk"}]}
{"id":"yolo-5su","title":"Task 2: Add beads conformance, yolo-agent coverage, and docs for capability-matrix behavior","design":"## Goal\nAdd production-grade validation and documentation for the new beads capability-matrix behavior (`bd` + `br`) so epic-level success criteria for coverage and docs are met.\n\n## Effort Estimate\n- 6-8 hours.\n\n## Implementation Checklist\n1. Conformance-style coverage for beads task manager\n- [ ] Create/extend `internal/beads/task_manager_test.go` to cover `NextTasks`, `SetTaskStatus`, and `SetTaskData` under strategy-selected command routing.\n- [ ] Add cases for `bd` profile, `br` profile, and probe failure path.\n- [ ] Assert command invocations and terminal-state behavior (failed/blocked suppression).\n\n2. yolo-agent tracker wiring coverage\n- [ ] Add tests in `cmd/yolo-agent` to verify beads profile path behaves correctly when capability probe succeeds and fails.\n- [ ] Ensure failure path returns actionable startup/config guidance (no silent fallback).\n\n3. Documentation updates\n- [ ] Update `README.md` and `docs/config-workflow.md` to describe capability detection and sync-mode behavior (`active`, `flush_only`, `noop`).\n- [ ] Document caveat that probe failure blocks startup for beads task manager path until backend availability is fixed.\n\n4. Verification\n- [ ] Run targeted tests for added/changed files.\n- [ ] Run docs contract tests touching modified docs.\n\n## Success Criteria (MEASURABLE)\n- [ ] `go test ./internal/beads -count=1` passes with new conformance-style task manager assertions.\n- [ ] `go test ./cmd/yolo-agent -run \"Test.*Beads.*\" -count=1` passes with beads profile coverage.\n- [ ] `go test ./internal/docs -count=1` passes after docs updates.\n- [ ] No regression in tracker profile selection tests (`go test ./cmd/yolo-agent -run \"TestDetectTrackerType|TestResolveTrackerProfile\" -count=1`).\n\n## Key Considerations (SRE)\n- **Edge case:** probe failure must fail closed with actionable error, not silently route to incorrect backend semantics.\n- **Edge case:** docs drift risk is high in this repo; docs changes must satisfy contract tests.\n- **Edge case:** when both `.beads` and `.tickets` exist, tracker-detection behavior must remain explicit and tested.\n- **Safety:** preserve existing `bd` behavior parity while expanding test matrix.\n\n## Anti-Patterns (FORBIDDEN)\n- ❌ No tests that only check symbol existence or non-nil values (must assert behavior/output).\n- ❌ No docs-only changes without matching behavior/test coverage.\n- ❌ No broad tracker refactor outside beads scope in this task.\n- ❌ No swallowing capability probe errors to keep execution moving.","status":"closed","priority":1,"issue_type":"feature","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-23T05:06:14.343550659-05:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-23T05:12:07.531824691-05:00","closed_at":"2026-02-23T05:12:07.531824691-05:00","close_reason":"Closed","dependencies":[{"issue_id":"yolo-5su","depends_on_id":"yolo-xu8","type":"parent-child","created_at":"2026-02-23T05:06:19.517168608-05:00","created_by":"Dmitry Polishuk"},{"issue_id":"yolo-5su","depends_on_id":"yolo-1dk","type":"blocks","created_at":"2026-02-23T05:06:24.692904162-05:00","created_by":"Dmitry Polishuk"}]}
{"id":"yolo-runner-3l2","title":"Test Epic","status":"open","priority":2,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-22T21:20:37.853077115+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-22T21:20:37.853077115+02:00"}
{"id":"yolo-runner-3l2.1","title":"Test task for yolo-agent","notes":"triage_reason=review verdict returned fail","status":"closed","priority":2,"issue_type":"task","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-22T21:20:41.618265154+02:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-22T21:43:39.937823915+02:00","closed_at":"2026-02-22T21:43:39.937830548+02:00","dependencies":[{"issue_id":"yolo-runner-3l2.1","depends_on_id":"yolo-runner-3l2","type":"parent-child","created_at":"2026-02-22T21:20:41.620329036+02:00","created_by":"Dmitry Polishuk"}]}
{"id":"yolo-xu8","title":"Feature: Dual beads support via capability-matrix adapter","design":"## Requirements (IMMUTABLE)\n- Runner supports dual beads backends (`bd` and `br`) through one capability-matrix adapter.\n- Task lifecycle stays invariant: select -\u003e claim -\u003e execute -\u003e close, with backend-specific flush/sync phase.\n- Capability probing determines backend behavior at runtime (binary, version, command semantics) instead of hardcoded assumptions.\n- Existing `bd` behavior remains backward compatible by default.\n- Add conformance/E2E coverage for beads paths in yolo-agent.\n\n## Success Criteria (MUST ALL BE TRUE)\n- [ ] Adapter correctly detects `bd` vs `br` and chooses command strategy.\n- [ ] `bd` flow remains passing for existing behavior (no regressions).\n- [ ] Beads conformance tests and at least one yolo-agent beads E2E path pass.\n- [ ] Docs updated for detection, config precedence nuances, and sync semantics caveats.\n- [ ] All project tests and hooks relevant to touched code pass.\n\n## Anti-Patterns (FORBIDDEN)\n- ❌ No hardcoded `bd sync` assumptions across all versions (reason: upstream behavior drifts by version).\n- ❌ No duplicated orchestration logic in separate adapters (reason: increases divergence and maintenance risk).\n- ❌ No docs-only fixes without tests for behavior changes (reason: docs are contract-tested in this repo).\n- ❌ No silent fallback that masks capability probe failures (reason: can corrupt task state transitions).\n\n## Approach\nImplement a single tracker capability-matrix adapter behind existing task manager boundaries. At startup, detect tool binary (`bd`/`br`), version, and key command semantics (`ready`, claim/update behavior, close/sync behavior). Cache these capabilities and route lifecycle operations through strategy functions.\n\nPreserve the current `bd` path as baseline and incrementally add `br` compatibility where semantics differ (especially flush/sync). Keep the execution loop unchanged and isolate compatibility in tracker integration layers and tests.\n\n## Architecture\n- New capability probe module in tracker integration layer.\n- Unified lifecycle operation interface (`SelectReady`, `Claim`, `SetStatus`, `SetData`, `Close`, `FinalizeSync`).\n- Strategy map keyed by detected capability profile.\n- Extended tests: conformance-style tracker suite + yolo-agent E2E beads lane.\n\n## Design Rationale\n### Problem\nCurrent repository supports beads integration, but sync/lifecycle semantics can drift across beads tool variants and versions. We need robust dual support without breaking existing `bd` behavior.\n\n### Research Findings\n**Codebase:**\n- `internal/beads/beads.go` currently uses `bd ready/update/close/sync` commands directly.\n- `cmd/yolo-agent/tracker_profile.go` already supports tracker type `beads`.\n- `internal/runner/runner.go` has close/sync lifecycle logic in compatibility flow.\n\n**External:**\n- beads (`bd`) docs and latest release notes indicate potential sync behavior drift by version.\n- beads_rust (`br`) emphasizes explicit/non-invasive sync workflows.\n\n### Approaches Considered\n1. **Capability-matrix adapter** ✓\n   - Pros: one orchestration path, runtime-safe behavior, easier long-term maintenance.\n   - Cons: slightly more upfront probe complexity.\n   - **Chosen because:** best balance of compatibility and consistency with existing architecture.\n\n2. **Separate bd and br adapters**\n   - Pros: straightforward initial split.\n   - Cons: duplicated lifecycle logic and test burden.\n   - **Rejected because:** high divergence risk.\n\n3. **bd-only freeze**\n   - Pros: minimal near-term work.\n   - Cons: does not satisfy dual support requirement.\n   - **Rejected because:** mismatches desired outcome.\n\n### Scope Boundaries\n**In scope:**\n- Capability probe + strategy routing for beads tool variants.\n- Tests/docs needed to enforce behavior.\n\n**Out of scope (deferred):**\n- Non-beads tracker redesign.\n- Major agent loop refactor unrelated to tracker compatibility.\n\n### Open Questions\n- Which minimum command subset should define “supported br profile” initially?\n- Should claim be required to be atomic on both backends or emulated with guarded transitions?","status":"open","priority":1,"issue_type":"epic","owner":"dmitry.polishuk@gmail.com","created_at":"2026-02-23T04:58:19.398764195-05:00","created_by":"Dmitry Polishuk","updated_at":"2026-02-23T04:58:19.398764195-05:00"}
